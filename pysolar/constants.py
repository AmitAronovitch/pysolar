#    Copyright Brandon Stafford
#
#    This file is part of Pysolar.
#
#    Pysolar is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 3 of the License, or
#    (at your option) any later version.
#
#    Pysolar is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License along
#    with Pysolar. If not, see <http://www.gnu.org/licenses/>.

"""This file is consists of numerical constants for calculating corrections,
such as the wiggling ("nutation") of the axis of the earth. It also includes
functions for building dictionaries of polynomial functions for rapid
calculation of corrections.

Most of the constants come from a 2005 paper by Reda and Andreas:

I. Reda and A. Andreas, "Solar Position Algorithm for Solar Radiation
Applications," National Renewable Energy Laboratory, NREL/TP-560-34302,
revised November 2005.

http://www.osti.gov/bridge/servlets/purl/15003974-iP3z6k/native/15003974.PDF

However, it seems that Reda and Andreas took the bulk of the constants
(L0, etc.) from Pierre Bretagnon and Gerard Francou's Variations Seculaires
des Orbites Planetaires, or VSOP87:

http://en.wikipedia.org/wiki/Secular_variations_of_the_planetary_orbits#VSOP87

See also ftp://ftp.imcce.fr/pub/ephem/planets/vsop87/VSOP87D.ear

"""

poly_dict = None

def get_poly_dict():
    """This function builds a dictionary of polynomial functions from a list of
    coefficients, so that the functions can be called by name. This is used in
    calculating nutation.

    """

    def build_poly_fit(a, b, c, d):
        return lambda x: a + b * x + c * x ** 2 + (x ** 3) / d
    #end build_poly_fit

#begin get_poly_dict
    global poly_dict
    if poly_dict == None :
        poly_dict = dict \
          (
            (name, build_poly_fit(*coeffs))
            for name, coeffs in
                (
                    ('ArgumentOfLatitudeOfMoon', (93.27191, 483202.017538, -0.0036825, 327270.0)),
                    ('LongitudeOfAscendingNode', (125.04452, -1934.136261, 0.0020708, 450000.0)),
                    ('MeanElongationOfMoon', (297.85036, 445267.111480, -0.0019142, 189474.0)),
                    ('MeanAnomalyOfMoon', (134.96298, 477198.867398, 0.0086972, 56250.0)),
                    ('MeanAnomalyOfSun', (357.52772, 35999.050340, -0.0001603, -300000.0)),
                )
          )
    #end if
    return \
        poly_dict
#end get_poly_dict

earth_radius = 6378140.0 # meters
earth_axis_inclination = 23.45 # degrees

standard_pressure = 101325.00 # pascals
standard_temperature = 288.15 # kelvin
earth_temperature_lapse_rate = -0.0065 # change in temperature with height, kelvin/metre
air_gas_constant = 8.31432 # N*m/s^2
earth_gravity = 9.80665 # N/m^2
earth_atmosphere_molar_mass = 0.0289644 # kg/mol

seconds_per_day = 86400
julian_day_offset = 1721425 - 0.5 # add to datetime.datetime.toordinal() to get Julian day number
gregorian_day_offset = 719163 # number of days to add to datetime.datetime.timestamp() / seconds_per_day to agree with datetime.datetime.toordinal()

aberration_sin_terms = [[0,0,0,0,1],
    [-2,0,0,2,2],
    [0,0,0,2,2],
    [0,0,0,0,2],
    [0,1,0,0,0],
    [0,0,1,0,0],
    [-2,1,0,2,2],
    [0,0,0,2,1],
    [0,0,1,2,2],
    [-2,-1,0,2,2],
    [-2,0,1,0,0],
    [-2,0,0,2,1],
    [0,0,-1,2,2],
    [2,0,0,0,0],
    [0,0,1,0,1],
    [2,0,-1,2,2],
    [0,0,-1,0,1],
    [0,0,1,2,1],
    [-2,0,2,0,0],
    [0,0,-2,2,1],
    [2,0,0,2,2],
    [0,0,2,2,2],
    [0,0,2,0,0],
    [-2,0,1,2,2],
    [0,0,0,2,0],
    [-2,0,0,2,0],
    [0,0,-1,2,1],
    [0,2,0,0,0],
    [2,0,-1,0,1],
    [-2,2,0,2,2],
    [0,1,0,0,1],
    [-2,0,1,0,1],
    [0,-1,0,0,1],
    [0,0,2,-2,0],
    [2,0,-1,2,1],
    [2,0,1,2,2],
    [0,1,0,2,2],
    [-2,1,1,0,0],
    [0,-1,0,2,2],
    [2,0,0,2,1],
    [2,0,1,0,0],
    [-2,0,2,2,2],
    [-2,0,1,2,1],
    [2,0,-2,0,1],
    [2,0,0,0,1],
    [0,-1,1,0,0],
    [-2,-1,0,2,1],
    [-2,0,0,0,1],
    [0,0,2,2,1],
    [-2,0,2,0,1],
    [-2,1,0,2,1],
    [0,0,1,-2,0],
    [-1,0,1,0,0],
    [-2,1,0,0,0],
    [1,0,0,0,0],
    [0,0,1,2,0],
    [0,0,-2,2,2],
    [-1,-1,1,0,0],
    [0,1,1,0,0],
    [0,-1,1,2,2],
    [2,-1,-1,2,2],
    [0,0,3,2,2],
    [2,-1,0,2,2]]

nutation_coefficients = [[-171996,-174.2,92025,8.9],
    [-13187,-1.6,5736,-3.1],
    [-2274,-0.2,977,-0.5],
    [2062,0.2,-895,0.5],
    [1426,-3.4,54,-0.1],
    [712,0.1,-7,0],
    [-517,1.2,224,-0.6],
    [-386,-0.4,200,0],
    [-301,0,129,-0.1],
    [217,-0.5,-95,0.3],
    [-158,0,0,0],
    [129,0.1,-70,0],
    [123,0,-53,0],
    [63,0,0,0],
    [63,0.1,-33,0],
    [-59,0,26,0],
    [-58,-0.1,32,0],
    [-51,0,27,0],
    [48,0,0,0],
    [46,0,-24,0],
    [-38,0,16,0],
    [-31,0,13,0],
    [29,0,0,0],
    [29,0,-12,0],
    [26,0,0,0],
    [-22,0,0,0],
    [21,0,-10,0],
    [17,-0.1,0,0],
    [16,0,-8,0],
    [-16,0.1,7,0],
    [-15,0,9,0],
    [-13,0,7,0],
    [-12,0,6,0],
    [11,0,0,0],
    [-10,0,5,0],
    [-8,0,3,0],
    [7,0,-3,0],
    [-7,0,0,0],
    [-7,0,3,0],
    [-7,0,3,0],
    [6,0,0,0],
    [6,0,-3,0],
    [6,0,-3,0],
    [-6,0,3,0],
    [-6,0,3,0],
    [5,0,0,0],
    [-5,0,3,0],
    [-5,0,3,0],
    [-5,0,3,0],
    [4,0,0,0],
    [4,0,0,0],
    [4,0,0,0],
    [-4,0,0,0],
    [-4,0,0,0],
    [-4,0,0,0],
    [3,0,0,0],
    [-3,0,0,0],
    [-3,0,0,0],
    [-3,0,0,0],
    [-3,0,0,0],
    [-3,0,0,0],
    [-3,0,0,0],
    [-3,0,0,0]]

L0 = [[175347046.0,0,0],
[3341656.0,4.6692568,6283.07585],
[34894.0,4.6261,12566.1517],
[3497.0,2.7441,5753.3849],
[3418.0,2.8289,3.5231],
[3136.0,3.6277,77713.7715],
[2676.0,4.4181,7860.4194],
[2343.0,6.1352,3930.2097],
[1324.0,0.7425,11506.7698],
[1273.0,2.0371,529.691],
[1199.0,1.1096,1577.3435],
[990,5.233,5884.927],
[902,2.045,26.298],
[857,3.508,398.149],
[780,1.179,5223.694],
[753,2.533,5507.553],
[505,4.583,18849.228],
[492,4.205,775.523],
[357,2.92,0.067],
[317,5.849,11790.629],
[284,1.899,796.298],
[271,0.315,10977.079],
[243,0.345,5486.778],
[206,4.806,2544.314],
[205,1.869,5573.143],
[202,2.4458,6069.777],
[156,0.833,213.299],
[132,3.411,2942.463],
[126,1.083,20.775],
[115,0.645,0.98],
[103,0.636,4694.003],
[102,0.976,15720.839],
[102,4.267,7.114],
[99,6.21,2146.17],
[98,0.68,155.42],
[86,5.98,161000.69],
[85,1.3,6275.96],
[85,3.67,71430.7],
[80,1.81,17260.15],
[79,3.04,12036.46],
[71,1.76,5088.63],
[74,3.5,3154.69],
[74,4.68,801.82],
[70,0.83,9437.76],
[62,3.98,8827.39],
[61,1.82,7084.9],
[57,2.78,6286.6],
[56,4.39,14143.5],
[56,3.47,6279.55],
[52,0.19,12139.55],
[52,1.33,1748.02],
[51,0.28,5856.48],
[49,0.49,1194.45],
[41,5.37,8429.24],
[41,2.4,19651.05],
[39,6.17,10447.39],
[37,6.04,10213.29],
[37,2.57,1059.38],
[36,1.71,2352.87],
[36,1.78,6812.77],
[33,0.59,17789.85],
[30,0.44,83996.85],
[30,2.74,1349.87],
[25,3.16,4690.48]]

L1 = [[628331966747.0,0,0],
[206059.0,2.678235,6283.07585],
[4303.0,2.6351,12566.1517],
[425.0,1.59,3.523],
[119.0,5.796,26.298],
[109.0,2.966,1577.344],
[93,2.59,18849.23],
[72,1.14,529.69],
[68,1.87,398.15],
[67,4.41,5507.55],
[59,2.89,5223.69],
[56,2.17,155.42],
[45,0.4,796.3],
[36,0.47,775.52],
[29,2.65,7.11],
[21,5.34,0.98],
[19,1.85,5486.78],
[19,4.97,213.3],
[17,2.99,6275.96],
[16,0.03,2544.31],
[16,1.43,2146.17],
[15,1.21,10977.08],
[12,2.83,1748.02],
[12,3.26,5088.63],
[12,5.27,1194.45],
[12,2.08,4694],
[11,0.77,553.57],
[10,1.3,3286.6],
[10,4.24,1349.87],
[9,2.7,242.73],
[9,5.64,951.72],
[8,5.3,2352.87],
[6,2.65,9437.76],
[6,4.67,4690.48]]

L2 = [[52919.0,0,0],
[8720.0,1.0721,6283.0758],
[309.0,0.867,12566.152],
[27,0.05,3.52],
[16,5.19,26.3],
[16,3.68,155.42],
[10,0.76,18849.23],
[9,2.06,77713.77],
[7,0.83,775.52],
[5,4.66,1577.34],
[4,1.03,7.11],
[4,3.44,5573.14],
[3,5.14,796.3],
[3,6.05,5507.55],
[3,1.19,242.73],
[3,6.12,529.69],
[3,0.31,398.15],
[3,2.28,553.57],
[2,4.38,5223.69],
[2,3.75,0.98]]

L3 = [[289.0,5.844,6283.076],
[35,0,0],
[17,5.49,12566.15],
[3,5.2,155.42],
[1,4.72,3.52],
[1,5.3,18849.23],
[1,5.97,242.73]]

L4 = [[114.0,3.142,0],
[8,4.13,6283.08],
[1,3.84,12566.15]]

L5 = [[1,3.14,0]]

B0 = [[280.0,3.199,84334.662],
[102.0,5.422,5507.553],
[80,3.88,5223.69],
[44,3.7,2352.87],
[32,4,1577.34]]

B1 = [[9,3.9,5507.55],
[6,1.73,5223.69]]


R0 = [[100013989.0,0,0],
[1670700.0,3.0984635,6283.07585],
[13956.0,3.05525,12566.1517],
[3084.0,5.1985,77713.7715],
[1628.0,1.1739,5753.3849],
[1576.0,2.8469,7860.4194],
[925.0,5.453,11506.77],
[542.0,4.564,3930.21],
[472.0,3.661,5884.927],
[346.0,0.964,5507.553],
[329.0,5.9,5223.694],
[307.0,0.299,5573.143],
[243.0,4.273,11790.629],
[212.0,5.847,1577.344],
[186.0,5.022,10977.079],
[175.0,3.012,18849.228],
[110.0,5.055,5486.778],
[98,0.89,6069.78],
[86,5.69,15720.84],
[86,1.27,161000.69],
[85,0.27,17260.15],
[63,0.92,529.69],
[57,2.01,83996.85],
[56,5.24,71430.7],
[49,3.25,2544.31],
[47,2.58,775.52],
[45,5.54,9437.76],
[43,6.01,6275.96],
[39,5.36,4694],
[38,2.39,8827.39],
[37,0.83,19651.05],
[37,4.9,12139.55],
[36,1.67,12036.46],
[35,1.84,2942.46],
[33,0.24,7084.9],
[32,0.18,5088.63],
[32,1.78,398.15],
[28,1.21,6286.6],
[28,1.9,6279.55],
[26,4.59,10447.39]]

R1 = [[103019.0,1.10749,6283.07585],
[1721.0,1.0644,12566.1517],
[702.0,3.142,0],
[32,1.02,18849.23],
[31,2.84,5507.55],
[25,1.32,5223.69],
[18,1.42,1577.34],
[10,5.91,10977.08],
[9,1.42,6275.96],
[9,0.27,5486.78]]

R2 = [[4359.0,5.7846,6283.0758],
[124.0,5.579,12566.152],
[12,3.14,0],
[9,3.63,77713.77],
[6,1.87,5573.14],
[3,5.47,18849]]

R3 = [[145.0,4.273,6283.076],
[7,3.92,12566.15]]

R4 = [[4,2.56,6283.08]]

# table generated by util/get_delta_t script
delta_t_base_year = 1973
delta_t_base_month = 2
delta_t = \
  [
        [ # 1973
            43.4724, # 2
            43.5648, # 3
            43.6737, # 4
            43.7782, # 5
            43.8763, # 6
            43.9562, # 7
            44.0315, # 8
            44.1132, # 9
            44.1982, # 10
            44.2952, # 11
            44.3936, # 12
        ],
        [ # 1974
            44.4841, # 1
            44.5646, # 2
            44.6425, # 3
            44.7386, # 4
            44.8370, # 5
            44.9302, # 6
            44.9986, # 7
            45.0584, # 8
            45.1284, # 9
            45.2064, # 10
            45.2980, # 11
            45.3897, # 12
        ],
        [ # 1975
            45.4761, # 1
            45.5633, # 2
            45.6450, # 3
            45.7375, # 4
            45.8284, # 5
            45.9133, # 6
            45.9820, # 7
            46.0408, # 8
            46.1067, # 9
            46.1825, # 10
            46.2789, # 11
            46.3713, # 12
        ],
        [ # 1976
            46.4567, # 1
            46.5445, # 2
            46.6311, # 3
            46.7302, # 4
            46.8284, # 5
            46.9247, # 6
            46.9970, # 7
            47.0709, # 8
            47.1451, # 9
            47.2362, # 10
            47.3413, # 11
            47.4319, # 12
        ],
        [ # 1977
            47.5214, # 1
            47.6049, # 2
            47.6837, # 3
            47.7781, # 4
            47.8771, # 5
            47.9687, # 6
            48.0348, # 7
            48.0942, # 8
            48.1608, # 9
            48.2460, # 10
            48.3439, # 11
            48.4355, # 12
        ],
        [ # 1978
            48.5344, # 1
            48.6325, # 2
            48.7294, # 3
            48.8365, # 4
            48.9353, # 5
            49.0319, # 6
            49.1013, # 7
            49.1591, # 8
            49.2286, # 9
            49.3070, # 10
            49.4018, # 11
            49.4945, # 12
        ],
        [ # 1979
            49.5862, # 1
            49.6805, # 2
            49.7602, # 3
            49.8556, # 4
            49.9489, # 5
            50.0347, # 6
            50.1019, # 7
            50.1622, # 8
            50.2260, # 9
            50.2968, # 10
            50.3831, # 11
            50.4599, # 12
        ],
        [ # 1980
            50.5387, # 1
            50.6161, # 2
            50.6866, # 3
            50.7658, # 4
            50.8454, # 5
            50.9187, # 6
            50.9761, # 7
            51.0278, # 8
            51.0843, # 9
            51.1538, # 10
            51.2319, # 11
            51.3063, # 12
        ],
        [ # 1981
            51.3808, # 1
            51.4526, # 2
            51.5160, # 3
            51.5985, # 4
            51.6809, # 5
            51.7573, # 6
            51.8133, # 7
            51.8532, # 8
            51.9014, # 9
            51.9603, # 10
            52.0328, # 11
            52.0985, # 12
        ],
        [ # 1982
            52.1668, # 1
            52.2316, # 2
            52.2938, # 3
            52.3680, # 4
            52.4465, # 5
            52.5180, # 6
            52.5752, # 7
            52.6178, # 8
            52.6668, # 9
            52.7340, # 10
            52.8056, # 11
            52.8792, # 12
        ],
        [ # 1983
            52.9565, # 1
            53.0445, # 2
            53.1268, # 3
            53.2197, # 4
            53.3024, # 5
            53.3747, # 6
            53.4335, # 7
            53.4778, # 8
            53.5300, # 9
            53.5845, # 10
            53.6523, # 11
            53.7256, # 12
        ],
        [ # 1984
            53.7882, # 1
            53.8367, # 2
            53.8830, # 3
            53.9443, # 4
            54.0042, # 5
            54.0536, # 6
            54.0856, # 7
            54.1084, # 8
            54.1463, # 9
            54.1914, # 10
            54.2452, # 11
            54.2958, # 12
        ],
        [ # 1985
            54.3427, # 1
            54.3911, # 2
            54.4320, # 3
            54.4898, # 4
            54.5456, # 5
            54.5977, # 6
            54.6355, # 7
            54.6532, # 8
            54.6776, # 9
            54.7174, # 10
            54.7741, # 11
            54.8253, # 12
        ],
        [ # 1986
            54.8713, # 1
            54.9161, # 2
            54.9581, # 3
            54.9997, # 4
            55.0476, # 5
            55.0912, # 6
            55.1132, # 7
            55.1328, # 8
            55.1532, # 9
            55.1898, # 10
            55.2416, # 11
            55.2838, # 12
        ],
        [ # 1987
            55.3222, # 1
            55.3613, # 2
            55.4063, # 3
            55.4629, # 4
            55.5111, # 5
            55.5524, # 6
            55.5812, # 7
            55.6004, # 8
            55.6262, # 9
            55.6656, # 10
            55.7168, # 11
            55.7698, # 12
        ],
        [ # 1988
            55.8197, # 1
            55.8615, # 2
            55.9130, # 3
            55.9663, # 4
            56.0220, # 5
            56.0700, # 6
            56.0939, # 7
            56.1105, # 8
            56.1314, # 9
            56.1611, # 10
            56.2068, # 11
            56.2583, # 12
        ],
        [ # 1989
            56.3000, # 1
            56.3399, # 2
            56.3790, # 3
            56.4283, # 4
            56.4804, # 5
            56.5352, # 6
            56.5697, # 7
            56.5983, # 8
            56.6328, # 9
            56.6739, # 10
            56.7332, # 11
            56.7972, # 12
        ],
        [ # 1990
            56.8553, # 1
            56.9111, # 2
            56.9755, # 3
            57.0471, # 4
            57.1136, # 5
            57.1738, # 6
            57.2226, # 7
            57.2597, # 8
            57.3073, # 9
            57.3643, # 10
            57.4334, # 11
            57.5016, # 12
        ],
        [ # 1991
            57.5653, # 1
            57.6333, # 2
            57.6973, # 3
            57.7711, # 4
            57.8407, # 5
            57.9058, # 6
            57.9576, # 7
            57.9975, # 8
            58.0426, # 9
            58.1043, # 10
            58.1679, # 11
            58.2389, # 12
        ],
        [ # 1992
            58.3092, # 1
            58.3833, # 2
            58.4537, # 3
            58.5401, # 4
            58.6228, # 5
            58.6917, # 6
            58.7410, # 7
            58.7836, # 8
            58.8406, # 9
            58.8986, # 10
            58.9714, # 11
            59.0438, # 12
        ],
        [ # 1993
            59.1218, # 1
            59.2003, # 2
            59.2747, # 3
            59.3574, # 4
            59.4434, # 5
            59.5242, # 6
            59.5850, # 7
            59.6344, # 8
            59.6928, # 9
            59.7588, # 10
            59.8386, # 11
            59.9111, # 12
        ],
        [ # 1994
            59.9845, # 1
            60.0564, # 2
            60.1231, # 3
            60.2042, # 4
            60.2804, # 5
            60.3530, # 6
            60.4012, # 7
            60.4440, # 8
            60.4900, # 9
            60.5578, # 10
            60.6324, # 11
            60.7059, # 12
        ],
        [ # 1995
            60.7853, # 1
            60.8664, # 2
            60.9387, # 3
            61.0277, # 4
            61.1103, # 5
            61.1870, # 6
            61.2454, # 7
            61.2881, # 8
            61.3378, # 9
            61.4036, # 10
            61.4760, # 11
            61.5525, # 12
        ],
        [ # 1996
            61.6287, # 1
            61.6846, # 2
            61.7433, # 3
            61.8132, # 4
            61.8823, # 5
            61.9497, # 6
            61.9969, # 7
            62.0343, # 8
            62.0714, # 9
            62.1202, # 10
            62.1810, # 11
            62.2382, # 12
        ],
        [ # 1997
            62.2950, # 1
            62.3506, # 2
            62.3995, # 3
            62.4754, # 4
            62.5463, # 5
            62.6136, # 6
            62.6571, # 7
            62.6942, # 8
            62.7383, # 9
            62.7926, # 10
            62.8567, # 11
            62.9146, # 12
        ],
        [ # 1998
            62.9659, # 1
            63.0217, # 2
            63.0807, # 3
            63.1462, # 4
            63.2053, # 5
            63.2599, # 6
            63.2844, # 7
            63.2961, # 8
            63.3126, # 9
            63.3422, # 10
            63.3871, # 11
            63.4339, # 12
        ],
        [ # 1999
            63.4673, # 1
            63.4979, # 2
            63.5319, # 3
            63.5679, # 4
            63.6104, # 5
            63.6444, # 6
            63.6642, # 7
            63.6739, # 8
            63.6926, # 9
            63.7147, # 10
            63.7518, # 11
            63.7927, # 12
        ],
        [ # 2000
            63.8285, # 1
            63.8557, # 2
            63.8804, # 3
            63.9075, # 4
            63.9393, # 5
            63.9691, # 6
            63.9799, # 7
            63.9833, # 8
            63.9938, # 9
            64.0093, # 10
            64.0400, # 11
            64.0670, # 12
        ],
        [ # 2001
            64.0908, # 1
            64.1068, # 2
            64.1282, # 3
            64.1584, # 4
            64.1833, # 5
            64.2094, # 6
            64.2117, # 7
            64.2073, # 8
            64.2116, # 9
            64.2223, # 10
            64.2500, # 11
            64.2761, # 12
        ],
        [ # 2002
            64.2998, # 1
            64.3192, # 2
            64.3450, # 3
            64.3735, # 4
            64.3943, # 5
            64.4151, # 6
            64.4132, # 7
            64.4118, # 8
            64.4097, # 9
            64.4168, # 10
            64.4329, # 11
            64.4511, # 12
        ],
        [ # 2003
            64.4734, # 1
            64.4893, # 2
            64.5053, # 3
            64.5269, # 4
            64.5471, # 5
            64.5597, # 6
            64.5512, # 7
            64.5371, # 8
            64.5359, # 9
            64.5415, # 10
            64.5544, # 11
            64.5654, # 12
        ],
        [ # 2004
            64.5736, # 1
            64.5891, # 2
            64.6015, # 3
            64.6176, # 4
            64.6374, # 5
            64.6549, # 6
            64.6530, # 7
            64.6379, # 8
            64.6372, # 9
            64.6400, # 10
            64.6543, # 11
            64.6723, # 12
        ],
        [ # 2005
            64.6876, # 1
            64.7052, # 2
            64.7313, # 3
            64.7575, # 4
            64.7811, # 5
            64.8001, # 6
            64.7995, # 7
            64.7876, # 8
            64.7831, # 9
            64.7921, # 10
            64.8096, # 11
            64.8311, # 12
        ],
        [ # 2006
            64.8452, # 1
            64.8597, # 2
            64.8850, # 3
            64.9175, # 4
            64.9480, # 5
            64.9794, # 6
            64.9895, # 7
            65.0028, # 8
            65.0138, # 9
            65.0371, # 10
            65.0773, # 11
            65.1122, # 12
        ],
        [ # 2007
            65.1464, # 1
            65.1833, # 2
            65.2145, # 3
            65.2494, # 4
            65.2921, # 5
            65.3279, # 6
            65.3413, # 7
            65.3452, # 8
            65.3496, # 9
            65.3711, # 10
            65.3972, # 11
            65.4296, # 12
        ],
        [ # 2008
            65.4573, # 1
            65.4868, # 2
            65.5152, # 3
            65.5450, # 4
            65.5781, # 5
            65.6127, # 6
            65.6288, # 7
            65.6370, # 8
            65.6493, # 9
            65.6760, # 10
            65.7097, # 11
            65.7461, # 12
        ],
        [ # 2009
            65.7768, # 1
            65.8025, # 2
            65.8237, # 3
            65.8595, # 4
            65.8973, # 5
            65.9323, # 6
            65.9509, # 7
            65.9534, # 8
            65.9628, # 9
            65.9839, # 10
            66.0147, # 11
            66.0420, # 12
        ],
        [ # 2010
            66.0699, # 1
            66.0961, # 2
            66.1310, # 3
            66.1683, # 4
            66.2072, # 5
            66.2356, # 6
            66.2409, # 7
            66.2335, # 8
            66.2349, # 9
            66.2441, # 10
            66.2751, # 11
            66.3054, # 12
        ],
        [ # 2011
            66.3246, # 1
            66.3406, # 2
            66.3624, # 3
            66.3957, # 4
            66.4289, # 5
            66.4619, # 6
            66.4749, # 7
            66.4751, # 8
            66.4829, # 9
            66.5056, # 10
            66.5383, # 11
            66.5706, # 12
        ],
        [ # 2012
            66.6030, # 1
            66.6340, # 2
            66.6569, # 3
            66.6925, # 4
            66.7289, # 5
            66.7579, # 6
            66.7708, # 7
            66.7740, # 8
            66.7846, # 9
            66.8103, # 10
            66.8400, # 11
            66.8779, # 12
        ],
        [ # 2013
            66.9069, # 1
            66.9443, # 2
            66.9763, # 3
            67.0258, # 4
            67.0716, # 5
            67.1100, # 6
            67.1266, # 7
            67.1331, # 8
            67.1458, # 9
            67.1718, # 10
            67.2091, # 11
            67.2460, # 12
        ],
        [ # 2014
            67.2810, # 1
            67.3136, # 2
            67.3457, # 3
            67.3890, # 4
        ],
    ] # delta_t

def compute_delta_t(when) :
    "returns a suitable value for delta_t for the given datetime."
    when = when.utctimetuple()
    year, month = when.tm_year, when.tm_mon
    if year < delta_t_base_year :
        year = delta_t_base_year
        month = 1
    elif year == delta_t_base_year :
        month = max(0, month - delta_t_base_month) + 1
    elif year >= delta_t_base_year + len(delta_t) :
        year = delta_t_base_year + len(delta_t) - 1
    #end if
    if year == delta_t_base_year + len(delta_t) - 1 :
        month = min(month, len(delta_t[year - delta_t_base_year]))
    #end if
    return \
        delta_t[year - delta_t_base_year][month - 1]
          # don't bother doing any fancy interpolation
#end compute_delta_t
